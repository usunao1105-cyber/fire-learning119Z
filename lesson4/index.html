<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>林野火災対策 e-Learning</title>
    <!-- Google Fonts for "High-Class" Aesthetic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Serif+JP:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* * CORE DESIGN PRINCIPLES 
         * Theme: "Noble Protection" - Deep Navy, Gold, and Clean White.
         */

        :root {
            --primary-navy: #0f172a;       /* Deep Navy Background */
            --secondary-navy: #1e293b;     /* Card Background */
            --accent-gold: #d4af37;        /* Gold for highlights */
            --accent-gold-light: #f3e5ab;  /* Light Gold for hover */
            --text-white: #f8fafc;         /* Primary Text */
            --text-muted: #94a3b8;         /* Secondary Text */
            --danger: #ef4444;             /* Incorrect/Error */
            --success: #10b981;            /* Correct/Success */
            --glass-bg: rgba(30, 41, 59, 0.95);
            --border-radius: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--primary-navy);
            font-family: 'Noto Sans JP', sans-serif;
            color: var(--text-white);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 背景画像の設定 */
            background-image: 
                linear-gradient(rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95)),
                url('https://images.unsplash.com/photo-1465103692162-8a5a68d83d10?q=80&w=2000&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            padding: 20px;
        }

        /* --- APP CONTAINER (Responsive) --- */
        .app-container {
            width: 100%;
            max-width: 1000px;
            height: 80vh; /* 固定高さを設定して内部スクロールさせる */
            min-height: 600px;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            body {
                padding: 0;
                align-items: flex-start; /* スマホでは上詰め */
            }
            .app-container {
                height: 100vh;
                border-radius: 0;
                border: none;
            }
        }

        .gold-line {
            position: absolute;
            bottom: 40px;
            left: 60px;
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, var(--accent-gold), transparent);
            z-index: 10;
        }

        /* --- VIEWS --- */
        .view {
            width: 100%;
            height: 100%;
            padding: 40px 60px;
            display: none; /* 基本非表示 */
            flex-direction: column;
            animation: fadeInView 0.5s ease forwards;
        }

        .view.active {
            display: flex;
        }

        @media (max-width: 768px) {
            .view {
                padding: 30px 20px;
            }
        }

        /* --- VIEW 1: INTRO --- */
        .intro-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            max-width: 800px;
        }

        .main-title {
            font-family: 'Noto Serif JP', serif;
            font-size: clamp(32px, 5vw, 64px); /* レスポンシブフォントサイズ */
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 20px;
            background: linear-gradient(to right, #fff, #cbd5e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: clamp(16px, 2vw, 24px);
            color: var(--text-muted);
            margin-bottom: 50px;
            font-weight: 300;
            border-left: 3px solid var(--accent-gold);
            padding-left: 20px;
            line-height: 1.6;
        }

        .btn-start {
            background: linear-gradient(135deg, var(--accent-gold), #b8860b);
            color: #fff;
            padding: 16px 48px;
            font-size: 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Noto Serif JP', serif;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.6);
        }

        /* --- VIEW 1.5: FAQ (LEARNING) --- */
        .faq-container {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 15px;
            /* Scrollbar styling */
            scrollbar-width: thin;
            scrollbar-color: var(--accent-gold) rgba(255,255,255,0.1);
        }

        .faq-container::-webkit-scrollbar {
            width: 8px;
        }
        .faq-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }
        .faq-container::-webkit-scrollbar-thumb {
            background-color: var(--accent-gold);
            border-radius: 4px;
        }

        .faq-category-title {
            font-family: 'Noto Serif JP', serif;
            font-size: 20px;
            color: var(--accent-gold);
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .faq-category-title:first-child {
            margin-top: 0;
        }

        .faq-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 20px;
            transition: background 0.2s;
        }

        .faq-item:hover {
            background: rgba(255,255,255,0.07);
        }

        .faq-q {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 10px;
            color: #fff;
            display: flex;
            gap: 10px;
            line-height: 1.5;
        }
        
        .faq-q::before {
            content: "Q.";
            color: var(--accent-gold);
            font-family: 'Noto Serif JP', serif;
        }

        .faq-a {
            font-size: 15px;
            color: #cbd5e1;
            line-height: 1.6;
            padding-left: 28px;
            position: relative;
        }

        .faq-a::before {
            content: "A.";
            position: absolute;
            left: 0;
            font-weight: 700;
            color: var(--success);
            font-family: 'Noto Serif JP', serif;
        }

        /* --- VIEW 2: QUIZ --- */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 15px;
            font-size: 14px;
            flex-shrink: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            letter-spacing: 1px;
        }

        .progress-indicator {
            font-family: 'Noto Serif JP', serif;
            font-size: 20px;
            color: var(--accent-gold);
        }

        .question-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 30px 40px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow-y: auto; /* スマホで質問が長い場合 */
        }
        
        @media (max-width: 768px) {
            .question-card {
                padding: 20px;
            }
        }

        .question-text {
            font-size: clamp(18px, 2.5vw, 24px);
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 30px;
            font-family: 'Noto Serif JP', serif;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr; /* スマホでは1列 */
            }
        }

        .option-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-white);
            padding: 15px 20px;
            border-radius: 8px;
            text-align: left;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            line-height: 1.4;
        }

        .option-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--accent-gold);
        }

        .option-btn.selected {
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            font-weight: 700;
        }
        
        .option-btn.disabled {
            cursor: default;
            pointer-events: none;
            opacity: 0.8;
        }

        .option-btn.correct-highlight {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--success);
            color: var(--success);
            position: relative;
        }
        
        .option-btn.correct-highlight::after {
            content: "\f00c"; /* FontAwesome check */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            right: 15px;
        }

        .option-btn.incorrect-highlight {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--danger);
            position: relative;
        }

        .option-btn.incorrect-highlight::after {
            content: "\f00d"; /* FontAwesome xmark */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            right: 15px;
        }

        .action-area {
            margin-top: auto;
            padding-top: 20px;
            display: flex;
            justify-content: flex-end;
        }

        .btn-next {
            background: var(--text-white);
            color: var(--primary-navy);
            padding: 12px 36px;
            border-radius: 4px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .btn-next:hover {
            background: var(--accent-gold-light);
        }

        .explanation-box {
            margin-top: 20px;
            padding: 20px;
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid var(--accent-gold);
            border-radius: 4px;
            font-size: 15px;
            line-height: 1.6;
            display: none;
            animation: fadeInView 0.5s ease;
        }

        /* --- VIEW 3: RESULTS --- */
        .result-container {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .score-circle {
            width: clamp(150px, 20vw, 200px);
            height: clamp(150px, 20vw, 200px);
            border-radius: 50%;
            border: 8px solid var(--accent-gold);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 40px;
            background: rgba(212, 175, 55, 0.1);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }

        .score-number {
            font-size: clamp(40px, 6vw, 60px);
            font-weight: 700;
            font-family: 'Noto Serif JP', serif;
            color: var(--text-white);
        }

        .score-label {
            font-size: 14px;
            color: var(--accent-gold);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .result-message {
            font-size: clamp(18px, 2.5vw, 24px);
            margin-bottom: 40px;
            color: var(--text-muted);
            max-width: 600px;
            line-height: 1.6;
        }

        /* Animations */
        @keyframes fadeInView {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Utility */
        .badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            background: var(--accent-gold);
            color: var(--primary-navy);
            margin-bottom: 20px;
            letter-spacing: 0.5px;
        }
        
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-shrink: 0;
        }
        
        .header-title {
            font-family:'Noto Serif JP';
            font-size:24px;
            color: var(--text-white);
        }

        .header-desc {
            color: var(--text-muted); 
            margin-bottom: 20px;
            font-size: 14px;
        }

    </style>
</head>
<body>

<div class="app-container">
    <div class="gold-line"></div>

    <!-- VIEW 1: INTRO -->
    <div id="view-intro" class="view active">
        <div class="intro-content">
            <span class="badge">消防職員向け専門課程</span>
            <h1 class="main-title">林野火災・空中消火<br>特別e-Learning</h1>
            <p class="subtitle">基礎知識から最新の空中消火戦術まで。<br>FAQ（よくある質問）で学習した後、理解度確認テストに挑戦してください。</p>
            <button class="btn-start" onclick="showFAQ()">研修資料（FAQ）を見る</button>
        </div>
    </div>

    <!-- VIEW 1.5: FAQ (LEARNING) -->
    <div id="view-faq" class="view">
        <div class="header-controls">
            <h2 class="header-title">学習資料 (FAQ)</h2>
        </div>
        <p class="header-desc">以下のFAQを一通り読み、知識を深めてください。<br>学習が終わったら、下部のボタンからテストを開始してください。</p>
        
        <div id="faq-content-area" class="faq-container">
            <!-- JS populates this -->
        </div>

        <div class="action-area" style="justify-content: center; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
            <button class="btn-start" onclick="startQuiz()">理解度確認テストへ進む</button>
        </div>
    </div>

    <!-- VIEW 2: QUIZ -->
    <div id="view-quiz" class="view">
        <div class="quiz-header">
            <div class="logo"><i class="fa-solid fa-helicopter"></i> Aerial Firefighting</div>
            <div class="progress-indicator">Question <span id="current-q-num">1</span> / 5</div>
        </div>
        
        <div class="question-card">
            <!-- Dynamic Content Here -->
            <h2 id="question-text" class="question-text">Loading...</h2>
            
            <div id="options-container" class="options-grid">
                <!-- Options injected by JS -->
            </div>

            <!-- Explanation Area (Appears after answer) -->
            <div id="explanation-area" class="explanation-box"></div>

            <div class="action-area">
                <button id="btn-action" class="btn-next" onclick="handleAction()">採点する</button>
            </div>
        </div>
    </div>

    <!-- VIEW 3: RESULTS -->
    <div id="view-result" class="view">
        <div class="result-container">
            <h2 class="main-title" style="font-size: clamp(32px, 5vw, 48px);">研修結果</h2>
            
            <div class="score-circle">
                <span class="score-label">Score</span>
                <span id="final-score" class="score-number">0</span>
            </div>

            <p id="result-message" class="result-message">お疲れ様でした。</p>

            <button class="btn-start" onclick="retryQuiz()">再挑戦する</button>
        </div>
    </div>
</div>

<script>
    /* --- FAQ DATA --- */
    const faqData = [
        {
            category: "1. 林野火災の基礎知識",
            items: [
                { q: "林野火災の主な出火原因は何ですか？", a: "例年、たき火、火入れ、放火（疑い含む）、たばこの不始末などの「人的要因」によるものが多くを占めています。" },
                { q: "林野火災が発生しやすい時期はいつですか？", a: "降水量が少なく空気が乾燥し、強風が吹きやすい3月から5月にかけて多く発生します。" },
                { q: "林野火災の消火が難しい理由は何ですか？", a: "地形が急峻で地上からの進入が困難であること、水利が乏しく放水が難しいこと、燃焼範囲が広く全体像の把握が困難であることなどが挙げられます。" },
                { q: "「ファイアライン」とは何ですか？", a: "火災の燃料となる可燃物を除去したり水で濡らしたりして作る「燃料の切れ目」のことです。" },
                { q: "地上消火における「側面挟撃消火戦術」とはどのようなものですか？", a: "急激に上昇延焼する斜面の火災に対し、側面から延焼ラインの幅を狭めるように尾根へ追い上げ、火勢が弱まったところを制圧する戦術です。" }
            ]
        },
        {
            category: "2. 空中消火の役割と戦術",
            items: [
                { q: "空中消火の主な目的は何ですか？", a: "ヘリコプター等で上空から水や消火剤を散布し、延焼速度を遅らせて火勢を弱め、地上部隊が活動しやすい環境を作ることです。" },
                { q: "空中消火だけで林野火災は完全に消せますか？", a: "困難です。空中散水は樹冠の火勢を抑えるのに有効ですが、樹木の下や地中の残り火まで完全に消すことは難しく、地上部隊による鎮火活動が不可欠です。" },
                { q: "「直接消火」と「間接消火」の違いは何ですか？", a: "「直接消火」は火頭や火線に直接散水して火勢を抑える方法で、「間接消火」は延焼が予想される未燃焼区域に散水して防火帯を補強する方法です。" },
                { q: "「モップアップ」とは何ですか？", a: "火災の鎮圧後、地上部隊が残り火や地中の熱源を一つずつ処理し、再燃を防ぐための残火処理作業のことです。" },
                { q: "大規模火災でのヘリコプターの「ゾーニング」とは何ですか？", a: "消防防災ヘリと自衛隊ヘリなど、所属や性能の異なる機体が混在する場合に、活動エリアや高度、離着陸場を分けて安全かつ効率的に活動させることです。" }
            ]
        },
        {
            category: "3. ヘリコプターと装備",
            items: [
                { q: "ヘリコプターの「タイプ1」とはどのような機体ですか？", a: "大型で最も高価なヘリコプターで、一度に数千ガロン（数トン）の水を運搬でき、15名以上の隊員を輸送できる能力を持ちます（例：CH-47など）。" },
                { q: "ヘリコプターの「タイプ2」とはどのような機体ですか？", a: "初期活動に有効な中型ヘリコプターで、最大9名の隊員輸送や、約300ガロン（約1,100リットル）の散水が可能です。" },
                { q: "「バンビバケット」とは何ですか？", a: "ヘリコプターの機体下部にワイヤーで吊り下げて使用する、折りたたみ可能な消火用水汲み上げバケットです。" },
                { q: "「ベリータンク（固定タンク）」の利点は何ですか？", a: "機体胴体下部に固定するため飛行が安定し、市街地上空でも安全性が高く、散水パターンの精密な制御が可能です。" },
                { q: "ヘリコプターはどうやって給水するのですか？", a: "ホバリングしながらバケットを水面に沈めるか、シュノーケル（吸水ホース）を使って湖や簡易水槽から吸水します。" },
                { q: "「簡易組立水槽（ポータブルタンク）」はいつ使いますか？", a: "火災現場近くに自然の水利（池や川）がない場合、地上部隊が設置し、ポンプ車等で水を補給してヘリコプターの給水拠点として使用します。" },
                { q: "消火剤（リターダント）にはどのような効果がありますか？", a: "難燃剤が含まれており、未燃焼の植物に付着させることで延焼を遅らせる効果があります。投下場所がわかるように赤く着色されていることが多いです。" },
                { q: "ヘリコプターからの散水量はどれくらいですか？", a: "機種によりますが、多用途ヘリ（UH-1等）で約0.5トン～1トン、大型ヘリ（CH-47等）で約6トン～8トン程度です。" },
                { q: "自衛隊のヘリコプター派遣を要請する基準は？", a: "都道府県知事が、消防防災ヘリコプターだけでは消火が困難と判断した場合に要請されます。" },
                { q: "「ホイスト装置」とは何ですか？", a: "ヘリコプターが着陸できない場所で、空中で停止（ホバリング）したまま人や物資を吊り上げ・吊り下ろしするためのウインチ装置です。" }
            ]
        },
        {
            category: "4. 最新技術とAI活用",
            items: [
                { q: "ファーロスター（FaroStar）社の「Guardian」とは何ですか？", a: "ドローンやヘリコプターに搭載した赤外線カメラとAI技術を組み合わせ、炎、人、動物をリアルタイムで識別・検知するシステムです。" },
                { q: "ドローンは林野火災でどのように役立ちますか？", a: "上空からの偵察、赤外線カメラによる隠れた火種（ホットスポット）の発見、延焼方向の予測などに活用されます。" },
                { q: "夜間の空中消火は可能ですか？", a: "従来は危険なため制限されていましたが、ナイトビジョン技術や大型ドローンの進化により、夜間の情報収集や消火活動が可能になりつつあります。" },
                { q: "「D-NET」とは何ですか？", a: "多数のヘリコプターの位置情報をリアルタイムで共有し、効率的な部隊運用や空中衝突防止を図る「ヘリコプター動態管理システム」です。" },
                { q: "2025年の大船渡市林野火災ではどのような技術が注目されましたか？", a: "乾燥と強風により拡大した火災に対し、AI技術やドローンを活用した早期発見・情報共有技術の重要性が再認識されました。" }
            ]
        },
        {
            category: "5. 制度と警報",
            items: [
                { q: "「林野火災警報」はいつから運用されますか？", a: "東京消防庁では、令和8年（2026年）1月1日から運用を開始する予定です。" },
                { q: "林野火災警報が発令されるとどうなりますか？", a: "対象区域内での火入れ、たき火、花火、喫煙などの「火の使用」が制限され、違反者には罰則が適用される場合があります。" },
                { q: "「林野火災注意報」とは何ですか？", a: "警報の前段階として、火の使用制限について努力義務を課すもので、令和8年（2026年）4月以降の運用開始が予定されています。" },
                { q: "どのような気象条件で林野火災警報が出ますか？", a: "強風注意報が発表され、かつ実効湿度が低い（乾燥している）場合や、降水量が少ない状態が続いている場合などが指標となります。" },
                { q: "消防署への届出が必要な行為とは？", a: "火災と見間違えるような煙や火が出る行為（どんど焼き等）を行う場合、事前に届出が必要です。" }
            ]
        },
        {
            category: "6. 連携と指揮体制",
            items: [
                { q: "現地指揮本部には誰が参加しますか？", a: "消防、自治体、警察、自衛隊、森林関係者などの責任者が集まり、情報の共有と調整を行います。" },
                { q: "林野火災防ぎょ図とは何ですか？", a: "地形、水利、道路、ヘリの着陸適地などが記載された地図で、関係機関が共通の認識を持つために使用されます。" },
                { q: "「グリッド図」はどう使いますか？", a: "地図に網目（グリッド）を入れ、座標で地点を示すことで、空と陸の部隊が正確な位置情報を共有するために使います。" },
                { q: "広域航空消防応援とは何ですか？", a: "大規模災害時に、都道府県の枠を超えて他の自治体の消防防災ヘリコプターが応援に駆けつける制度です。" },
                { q: "緊急消防援助隊とは何ですか？", a: "被災地の消防力だけでは対応困難な場合に、消防庁長官の要請・指示により全国から派遣される応援部隊です。" }
            ]
        },
        {
            category: "7. 具体的な活動事例",
            items: [
                { q: "令和3年（2021年）の足利市林野火災の特徴は？", a: "強風と乾燥により急速に拡大し、鎮火まで23日間を要しました。自衛隊や他県のヘリによる空中消火が延焼阻止に大きな役割を果たしました。" },
                { q: "2025年2月～3月の岩手県での山火事での自衛隊の活動は？", a: "大船渡市や陸前高田市の火災に対し、CH-47等のヘリコプターを投入し、海水などを汲み上げて数百回に及ぶ空中消火を実施しました。" },
                { q: "東日本大震災でのヘリコプターの活動は？", a: "津波で孤立した場所からの救助や、陸路が寸断された地域への物資輸送、広域的な情報収集に活躍しました。" },
                { q: "海外の森林火災と日本の違いは？", a: "海外（米国や豪州など）は規模が桁違いに大きく、大型機による活動が中心ですが、日本は急峻な地形が多く、中型ヘリや地上部隊との精密な連携が重視されます。" }
            ]
        },
        {
            category: "8. 課題と安全管理",
            items: [
                { q: "ヘリコプターの「ダウンウォッシュ」とは何ですか？", a: "ヘリコプターのローターが吹き下ろす強力な風のことです。地上部隊や砂塵に影響を与えるため、離着陸場の選定や散水高度に注意が必要です。" },
                { q: "ヘリコプター消火の際、地上部隊はどうすべきですか？", a: "投下される水や水圧による危険があるため、投下エリアから退避する必要があります。" },
                { q: "空中消火用バケットを使用する際のリスクは？", a: "強風時にバケットが振られることや、水利の底にある障害物でバケットを破損するリスクがあります。" },
                { q: "操縦士不足は問題になっていますか？", a: "はい。熟練操縦士の高齢化や退職に伴い、要員の確保が課題となっており、運航体制に影響が出る場合があります。" },
                { q: "山岳地帯での無線通信の課題は？", a: "地形により電波が届かない不感地帯が発生しやすいため、中継局の設置やヘリコプターを中継に利用するなどの対策が必要です。" }
            ]
        },
        {
            category: "9. 救急・救助との関連",
            items: [
                { q: "救急救命士はヘリコプターで何をしますか？", a: "機内で傷病者の観察や処置を行います。騒音や振動がある特殊な環境下での活動技術が求められます。" },
                { q: "ドクターヘリと消防防災ヘリの違いは？", a: "ドクターヘリは救急医療に特化していますが、消防防災ヘリは救助、消火、救急搬送など多目的な任務を遂行します。" }
            ]
        },
        {
            category: "10. その他・豆知識",
            items: [
                { q: "空中消火で海水を使うことはありますか？", a: "近くに真水の水源がない場合、海水を使用することがあります（例：2025年大船渡市火災）。" },
                { q: "ヘリコプターテレビ電送システム（ヘリテレ）とは？", a: "ヘリコプターから撮影した映像をリアルタイムで地上の対策本部などに伝送するシステムで、迅速な状況把握に不可欠です。" },
                { q: "ジェットシューターとは何ですか？", a: "地上隊員が背負って使用する水嚢（すいのう）式の消火装備で、残火処理などで使われます。" },
                { q: "消防団は林野火災でどのような役割を果たしますか？", a: "地元の地形に精通しており、消火活動の主力として、また残火処理や巡視活動において重要な役割を担います。" }
            ]
        }
    ];

    /* --- QUIZ DATA --- */
    const allQuestions = [
        { id: 1, q: "日本における林野火災の出火原因として、例年最も高い割合を占める要因はどれか。", opts: ["落雷", "人的要因（たき火、火入れ等）", "火山活動", "摩擦熱"], a: 1, exp: "林野火災の出火原因は、例年「たき火」「火入れ」「放火（疑い含む）」「たばこ」などの人的要因によるものが多くを占めています。" },
        { id: 2, q: "林野火災が年間で最も多く発生する月はいつか（令和4年データに基づく）。", opts: ["1月", "3月", "8月", "12月"], a: 1, exp: "林野火災は3月に最も多く発生しており、次いで4月、2月となっています。乾燥や強風、入山者の増加が重なるためです。" },
        { id: 3, q: "林野火災の消火活動が困難となる「特有の要因」として適切でないものはどれか。", opts: ["地形が急峻で地上からの進入が困難", "水利が乏しく放水が困難", "延焼範囲が広く全体像の把握が困難", "建物火災に比べて延焼速度が極めて遅い"], a: 3, exp: "林野火災は斜面などの地形や強風の影響を受けやすく、延焼速度は極めて速くなる傾向があります。" },
        { id: 4, q: "気象条件と火災の拡大について、正しい記述はどれか。", opts: ["湿度が低いほど、延焼速度は遅くなる", "風速が強いほど、飛び火による延焼拡大の危険性が高まる", "夜間は気温が上がるため、火勢が強まる", "降水直後は可燃物が濡れているため、火災は発生しない"], a: 1, exp: "強風は燃焼を促進させるだけでなく、火の粉を遠くまで飛ばし（飛び火）、離れた場所で新たな火災を引き起こす原因となります。" },
        { id: 5, q: "2025年2月に岩手県大船渡市で発生した大規模林野火災の主な拡大要因は何であったか。", opts: ["台風の直撃による倒木", "乾燥した気象条件と強風", "記録的な猛暑", "大規模な落雷"], a: 1, exp: "2025年の大船渡市林野火災は、乾燥した気象条件（低い相対湿度）と強風が吹いていたことにより急速に拡大しました。" },
        { id: 6, q: "ヘリコプターによる空中消火において、火頭や火線に対して直接散水し、火勢を抑制する戦術を何と呼ぶか。", opts: ["間接消火法", "直接消火法", "予防散水法", "モップアップ法"], a: 1, exp: "「直接消火法」は、激しい燃焼を伴う火頭や火線に直接水を投下し、温度を下げて火勢を抑制する戦術です。" },
        { id: 7, q: "「間接消火法」の主な目的として正しいものはどれか。", opts: ["火災の中心部を完全に鎮火させる", "地上部隊の進入路を洗浄する", "未燃焼区域を湿らせ、防火帯を補強する", "煙を除去して視界を確保する"], a: 2, exp: "「間接消火法」は、延焼方向にある未燃焼の植物などに散水し、地上部隊が作成するファイアラインを補完して延焼を阻止します。" },
        { id: 8, q: "大規模林野火災におけるヘリコプターの「ゾーニング」の説明として適切なものはどれか。", opts: ["全ヘリコプターが同じ高度で飛行すること", "消防ヘリと自衛隊ヘリ等の活動エリアや役割を分担すること", "燃料補給のために着陸する場所のこと", "延焼区域を色分けして地図に記載すること"], a: 1, exp: "複数の機関のヘリが活動する場合、機体の特性や任務に応じて、活動空域や離着陸場を分ける「ゾーニング」が行われます。" },
        { id: 9, q: "自衛隊の大型輸送ヘリコプター（CH-47等）が担当するのに最も適した任務はどれか。", opts: ["住宅密集地でのピンポイント消火", "狭隘な谷間での低空飛行偵察", "山中など広範囲への大量散水", "少人数の要救助者のホイスト救助"], a: 2, exp: "大型ヘリコプターは一度に大量の水（約6～8トン）を散布できるため、地上部隊が入山困難な山中での面的な消火活動に適しています。" },
        { id: 10, q: "ヘリコプターが空中消火を行う際、地上部隊がとるべき行動として正しいものはどれか。", opts: ["散水効果を確認するため、投下地点の真下に留まる", "ヘリコプターに向かって大きく手を振って合図する", "水圧や落下物の危険があるため、投下エリアから退避する", "ヘリコプターのダウンウォッシュを利用して火を吹き消す"], a: 2, exp: "空中消火の散水は強力な水圧や、倒木・落石を誘発する危険があるため、地上部隊は退避し安全を確保する必要があります。" },
        { id: 11, q: "ヘリコプターの機体下部にワイヤーで吊り下げて使用する消火用機材を何と呼ぶか。", opts: ["ベリータンク", "ファイアアタッカー", "消火バケット（バンビバケット等）", "ジェットシューター"], a: 2, exp: "機体からワイヤーで吊り下げて使用し、水面から直接取水（ディップ）が可能な装備は「消火バケット」です。" },
        { id: 12, q: "ヘリコプターの胴体下部に固定して使用する「タンク式（ファイアアタッカー）」の利点として正しいものはどれか。", opts: ["吊り下げ式よりも安価である", "飛行が安定し、散水制御が精密である", "どのようなヘリコプターにも取り付け可能である", "自然水利からの給水が不可能である"], a: 1, exp: "固定タンク式は機体に密着しているため飛行が安定し、市街地での安全性や散水パターンの精密な制御に優れています。" },
        { id: 13, q: "火災現場付近に自然水利がない場合、ヘリコプターへの給水拠点として地上部隊が設置するものは何か。", opts: ["簡易組立水槽（ポータブルタンク）", "浄水装置", "地下貯水槽", "高圧放水砲"], a: 0, exp: "自然水利が遠い場合、地上部隊が簡易組立水槽を設置し、ヘリコプターの給水拠点（ディップサイト）として機能させます。" },
        { id: 14, q: "空中消火に使用される「リターダント（遅延剤）」の主な効果は何か。", opts: ["火の温度を急激に下げる冷却効果のみ", "未燃焼の植物に付着し、延焼を遅らせる効果", "煙を消して視界を良くする効果", "土壌を栄養分で豊かにする効果"], a: 1, exp: "リターダントには難燃剤が含まれており、未燃焼の植物に付着させることで延焼を遅らせる効果があります。" },
        { id: 15, q: "ヘリコプターの動態情報をリアルタイムで共有し、効率的な運用や空中衝突防止を図るシステムを何というか。", opts: ["GPSマップ", "D-NET（ヘリコプター動態管理システム）", "カーナビゲーション", "ドローンレーダー"], a: 1, exp: "D-NETは、多数のヘリコプターの位置情報をリアルタイムで共有し、一元的な管理を可能にします。" },
        { id: 16, q: "地上部隊が行う「モップアップ（残火処理）」の重要性について、正しい記述はどれか。", opts: ["ヘリ散水だけで鎮火するため重要ではない", "表面の火が消えていれば問題ない", "地中や倒木の裏の火種を処理し、再燃を防ぐために不可欠", "主に延焼中の火勢を止めるために行われる"], a: 2, exp: "地中や倒木の裏などに残る火種を完全に消すことは難しく、地上部隊によるモップアップが再燃防止に不可欠です。" },
        { id: 17, q: "林野火災防ぎょにおいて、地図に網目を入れて座標で位置を共有する方法を何というか。", opts: ["メッシュロード", "グリッド図", "ゾーンマップ", "レーダーチャート"], a: 1, exp: "空と陸の部隊が正確な位置情報を共有するため、地図に網目を入れた「グリッド図」を用い、座標で地点を指示します。" },
        { id: 18, q: "地上隊員が背負って使用する、残火処理などに有効な水嚢（すいのう）式消火装備は何か。", opts: ["ジェットシューター", "バンビバケット", "ファイアアタッカー", "ホースカー"], a: 0, exp: "ジェットシューターは隊員が背負って運搬できる水タンク式の放水装備で、約18リットルの水を持ち運びます。" },
        { id: 19, q: "「ファイアライン」とは何を指すか。", opts: ["火災の最前線の炎の壁", "消防車が並んで放水する隊形", "可燃物を除去したり水で濡らして作る「燃料の切れ目」", "ヘリコプターの飛行ルート"], a: 2, exp: "ファイアラインは、火災の燃料となる可燃物を除去したり、水や薬剤で濡らして作る「燃料の切れ目（防ぎょ線）」のことです。" },
        { id: 20, q: "林野火災における「側面挟撃消火戦術」の説明として正しいものはどれか。", opts: ["火の正面から一気に放水して消火する", "側面から延焼幅を狭めるように追い上げ、火勢が弱まったところを制圧する", "ヘリコプターだけで周囲を囲い込む", "山頂から麓に向かって水を流す"], a: 1, exp: "急激に上昇延焼する斜面の火災に対し、側面から攻撃して延焼幅を狭め、尾根付近などで火勢が弱まったところを制圧する戦術です。" },
        { id: 21, q: "林野火災発生時に設置される「現地指揮本部」の役割として適切でないものはどれか。", opts: ["消火戦術の決定と部隊への指示", "関係機関（自衛隊、警察、自治体等）との調整", "報道機関への広報対応の一元化", "現場を離れて休憩する場所の提供"], a: 3, exp: "現地指揮本部は、情報の収集、戦術の決定、部隊指揮、関係機関との調整を行う中枢機能です。" },
        { id: 22, q: "ヘリコプターからの映像をリアルタイムで地上の対策本部に伝送するシステムを何と呼ぶか。", opts: ["ヘリテレ", "衛星電話", "フライトレコーダー", "ドライブレコーダー"], a: 0, exp: "ヘリコプターテレビ電送システム（ヘリテレ）は、上空からの映像をリアルタイムで地上に伝送し、迅速な状況把握を可能にします。" },
        { id: 23, q: "自衛隊のヘリコプター派遣を要請する際の原則的な基準はどれか。", opts: ["火災が発生したら直ちに要請する", "消防団員が不足している場合", "都道府県知事が、消防防災ヘリだけでは消火困難と判断した場合", "夜間になった場合"], a: 2, exp: "自衛隊への災害派遣要請は、原則として都道府県知事が行い、消防防災ヘリだけでは対応困難と判断された場合に行われます。" },
        { id: 24, q: "大規模火災において、複数のヘリコプターが安全に活動するために重要なことは何か。", opts: ["全機が独自の判断で最短ルートを飛ぶ", "無線交信を極力行わない", "統一された指揮下での空域統制と情報共有", "散水時以外は着陸して待機する"], a: 2, exp: "多数の航空機が集結する場合、空中衝突を防ぎ効率的に活動するため、指揮本部による空域統制とD-NET等を用いた情報共有が不可欠です。" },
        { id: 25, q: "異なる機関（消防、自衛隊、警察など）が連携する際、最も障害となりやすい問題の一つは何か。", opts: ["使用する水の成分の違い", "無線周波数の違いによる通信の困難さ", "ヘリコプターの色の違い", "パイロットの制服の違い"], a: 1, exp: "各機関が異なる無線周波数を使用している場合、直接の通信ができず情報の断絶が起こる可能性があるため、通信統制が必要です。" },
        { id: 26, q: "ファーロスター社の「Guardian」システムの特徴として正しいものはどれか。", opts: ["雨水を自動で集めるシステム", "赤外線カメラとAIを組み合わせ、炎や人をリアルタイムで識別する", "ドローンを自動で充電するステーション", "消火剤を製造するプラント"], a: 1, exp: "「Guardian」は、赤外線カメラとAI技術を組み合わせ、炎、人、動物をリアルタイムで識別・検知するシステムです。" },
        { id: 27, q: "夜間の林野火災対応におけるドローンの活用法として期待されているものはどれか。", opts: ["大量放水による完全鎮火", "赤外線カメラを用いた熱源（ホットスポット）の探知と情報収集", "隊員の輸送", "昼間と同様の有視界飛行による観光案内"], a: 1, exp: "赤外線カメラを搭載したドローンは夜間でも熱源を探知でき、翌朝の活動に向けた情報収集に有効です。" },
        { id: 28, q: "ドローンで撮影した多数の画像を合成し、位置や距離を正確に計測できる地図画像を何と呼ぶか。", opts: ["パノラマ写真", "オルソ画像", "スケッチ画", "魚眼レンズ画像"], a: 1, exp: "ドローンで撮影した多数の画像を処理して作成する、地図データと重ね合わせ可能な歪みのない画像を「オルソ画像」と呼びます。" },
        { id: 29, q: "2026年4月以降、林野火災対策として新たに運用が予定されている制度は何か。", opts: ["林野火災注意報", "森林立ち入り完全禁止令", "消防ヘリコプター有料化", "人工降雨装置の義務化"], a: 0, exp: "従来の警報に加え、火の使用制限について努力義務を課す「林野火災注意報」の運用が予定されています。" },
        { id: 30, q: "「林野火災警報」が発令された際、制限される行為として正しいものはどれか。", opts: ["屋内での調理", "火の粉が飛散しないガス器具の使用", "山林・原野等における火入れやたき火", "指定された喫煙所での喫煙"], a: 2, exp: "警報発令時は、山林や原野での火入れ、たき火、花火など、屋外において裸火を使用し火の粉が飛散する行為が制限されます。" },
        { id: 31, q: "ヘリコプターが低空でホバリングする際に発生する、強力な吹き下ろし風を何というか。", opts: ["アップドラフト", "ダウンウォッシュ", "テールウィンド", "クロスウィンド"], a: 1, exp: "ヘリコプターのローターが吹き下ろす風を「ダウンウォッシュ」と呼びます。地上部隊や砂塵に影響を与えるため注意が必要です。" },
        { id: 32, q: "「林野火災防ぎょ図」に記載しておくべき情報として、優先度が低いものはどれか。", opts: ["水利の位置", "ヘリコプターの着陸適地", "観光客向けのお土産店のリスト", "延焼拡大の要因となる地形や林相"], a: 2, exp: "防ぎょ図には、消火活動に直結する地形、水利、着陸適地、道路状況などを記載すべきです。" },
        { id: 33, q: "消防隊員が林野火災活動時に着用すべき装備（PPE）について、正しい記述はどれか。", opts: ["暑いので半袖で活動する", "動きやすいようにスニーカーを履く", "防火衣や呼吸器等、完全な個人用防護装備を着用する", "普段着で活動する"], a: 2, exp: "林野火災は状況が急変しやすく危険度が高いため、隊員の安全確保のために完全なPPEの着用が不可欠です。" },
        { id: 34, q: "空中消火用の水を海水で代用する場合の懸念点として、考慮すべきことはどれか。", opts: ["海水は火を消す能力が低い", "塩分による植物への影響や金属腐食のリスク", "海水は凍りやすい", "海水は真水より軽い"], a: 1, exp: "海水は真水がない場合の緊急手段として使われますが、塩分による土壌・植物への影響や、機体・地上資産の腐食リスクを考慮する必要があります。" },
        { id: 35, q: "消防団が林野火災で果たす役割として、適切でないものはどれか。", opts: ["地元の地形に精通したガイド役", "ホース延長や地上消火の主力", "残火処理（モップアップ）", "ヘリコプターの操縦"], a: 3, exp: "消防団は地域に精通しており消火活動の主力となりますが、ヘリコプターの操縦は専門の操縦士が行います。" },
        { id: 36, q: "令和3年（2021年）の足利市林野火災の教訓として再確認されたことは何か。", opts: ["林野火災は自然に鎮火するのを待つべきだ", "広域的な航空応援の要請タイミングが重要", "一般市民による消火活動だけで十分", "夜間の空中消火が最も効果的"], a: 1, exp: "強風等で地上消火が困難を極める中、早期の広域航空応援要請の重要性が再確認されました。" },
        { id: 37, q: "東日本大震災におけるヘリコプターの活動で、特筆すべき実績はどれか。", opts: ["観光客の遊覧飛行", "津波で孤立した場所からの救助や物資輸送", "高速道路の交通整理", "海上での漁業支援"], a: 1, exp: "東日本大震災では、陸路が寸断された孤立地域からの救助や、緊急物資の輸送にヘリコプターが極めて大きな役割を果たしました。" },
        { id: 38, q: "2019-2020年のオーストラリア森林火災の特徴として述べられていることは何か。", opts: ["被害が非常に小規模であった", "日本の国土の1/3にあたる面積が焼失するほど大規模だった", "主に都市部だけで発生した", "原因は全て放火であった"], a: 1, exp: "オーストラリアの森林火災は、日本の国土の約1/3に相当する面積が焼失するほどの大規模災害となりました。" },
        { id: 39, q: "「C-130」などの固定翼機による空中消火の特徴は何か。", opts: ["ホバリングしてピンポイントで給水できる", "一度に大量の消火剤や水を広範囲に投下できる", "狭いビルの屋上に着陸できる", "水中を潜行できる"], a: 1, exp: "大型固定翼機は、大量の消火剤（リターダント）や水を搭載し、広範囲に投下して防火帯を作る能力に優れています。" },
        { id: 40, q: "近年の林野火災対策において「空地連携」が重視される理由は何か。", opts: ["空中と地上の無線交信を楽しむため", "ヘリの抑制力と地上の鎮火力を組み合わせるため", "地上部隊がヘリに乗る練習をするため", "予算を使い切るため"], a: 1, exp: "ヘリコプターの抑制力と地上部隊の鎮火力を組み合わせることで、最も効率的かつ確実に火災を制圧できるためです。" },
        { id: 41, q: "消防防災ヘリコプターの「365日・24時間運航体制」の目的は何か。", opts: ["パイロットの飛行時間を稼ぐため", "いつどこで災害が発生しても素早く対応するため", "夜間の観光飛行を行うため", "予算を増やすため"], a: 1, exp: "災害は昼夜を問わず発生するため、常時即応できる体制を確保することが求められています。" },
        { id: 42, q: "ヘリコプター要請時に提供すべき情報として、最も適切でないものはどれか。", opts: ["離着陸可能な場所（ランデブーポイント）", "災害現場の指揮者の無線周波数", "現場付近の危険障害物（送電線など）", "隊員の好みの食事メニュー"], a: 3, exp: "迅速かつ安全な活動のためには、離着陸場、通信方法、障害物情報などの作戦情報が不可欠です。" },
        { id: 43, q: "大規模災害時に全国の消防機関から応援に駆けつける部隊を何というか。", opts: ["消防団", "自主防災組織", "緊急消防援助隊", "国際救助隊"], a: 2, exp: "被災地の消防力だけでは対応困難な場合に、消防庁長官の要請・指示により全国から派遣される応援部隊です。" },
        { id: 44, q: "「D-NET」で共有される情報に含まれないものはどれか。", opts: ["ヘリコプターの現在位置", "飛行軌跡", "文字メッセージ", "パイロットの心拍数"], a: 3, exp: "D-NETは機体の位置、軌跡、メッセージなどを共有しますが、パイロットの生体情報は通常含まれません。" },
        { id: 45, q: "ヘリコプターの活動を妨げる「ダウンウォッシュ」対策として、離着陸場に望ましい条件はどれか。", opts: ["砂埃が舞いやすい乾燥した砂地", "舗装されているか、芝地であること", "傾斜がきつい場所", "周囲に高い木が密生している場所"], a: 1, exp: "ダウンウォッシュによる砂塵の飛散を防ぎ、視界とエンジンを保護するため、舗装面や芝地が理想的です。" },
        { id: 46, q: "「タイプ1」ヘリコプターの特徴として正しいものはどれか。", opts: ["小型で小回りが利き、偵察に適している", "最大かつ最高速で、大量の水や人員を輸送できる", "水上での離着陸専用である", "無人で飛行する"], a: 1, exp: "タイプ1は大型ヘリコプターを指し、数千ガロンの水や15名以上の隊員を輸送できる高い能力を持ちます。" },
        { id: 47, q: "林野火災における「ホットスポット」とは何を指すか。", opts: ["隊員が休憩する場所", "携帯電話の電波が入る場所", "地表や地中に残っている高温の火種", "火災が最も激しく燃えている火頭"], a: 2, exp: "モップアップの対象となる、目に見えにくい地中の熱源や残り火のことをホットスポットと呼びます。" },
        { id: 48, q: "ヘリコプターが空中停止したまま救助活動を行う技術を何と呼ぶか。", opts: ["タキシング", "ホバリング（ホイスト救助）", "オートローテーション", "クルージング"], a: 1, exp: "着陸できない場所で空中で停止（ホバリング）し、ホイスト装置を使って隊員を降下・引き上げする技術です。" },
        { id: 49, q: "消火活動において「延焼阻止線」を設定する主な目的は何か。", opts: ["報道陣の立ち入りを制限するため", "外側への延焼を防ぎ、重要防ぎょ対象を守るため", "記念撮影の場所を決めるため", "休憩場所を確保するため"], a: 1, exp: "地上消火では、民家などの守るべき対象への延焼を防ぐため、延焼阻止線を設定して重点的に防ぎょします。" },
        { id: 50, q: "今後の林野火災対策として、ICT（情報通信技術）の活用で目指されている姿はどれか。", opts: ["全ての消火活動をロボットのみで行う", "紙の地図のみを使用した伝統的な指揮", "ドローン、AI、動態管理を統合し、正確な状況把握と指揮を行う", "通信機器を減らしてアナログ化する"], a: 2, exp: "D-NET、ドローン、AI解析などを組み合わせ、煙や夜間に左右されない「完全な状況把握」と効率的な指揮統制の実現が目指されています。" }
    ];

    /* --- STATE --- */
    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let userSelection = null; // Current selected index (0-3)

    /* --- DOM ELEMENTS --- */
    const viewIntro = document.getElementById('view-intro');
    const viewFaq = document.getElementById('view-faq');
    const viewQuiz = document.getElementById('view-quiz');
    const viewResult = document.getElementById('view-result');
    const faqContentArea = document.getElementById('faq-content-area');
    
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const currentQNum = document.getElementById('current-q-num');
    const btnAction = document.getElementById('btn-action');
    const explanationArea = document.getElementById('explanation-area');
    const finalScore = document.getElementById('final-score');
    const resultMessage = document.getElementById('result-message');

    /* --- FUNCTIONS --- */

    // Initialization
    window.onload = function() {
        renderFAQ();
    };

    function renderFAQ() {
        faqContentArea.innerHTML = '';
        faqData.forEach(cat => {
            const catTitle = document.createElement('div');
            catTitle.className = 'faq-category-title';
            catTitle.innerText = cat.category;
            faqContentArea.appendChild(catTitle);

            cat.items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'faq-item';
                itemDiv.innerHTML = `
                    <div class="faq-q">${item.q}</div>
                    <div class="faq-a">${item.a}</div>
                `;
                faqContentArea.appendChild(itemDiv);
            });
        });
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function switchView(viewId) {
        [viewIntro, viewFaq, viewQuiz, viewResult].forEach(el => el.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        // Scroll to top on view switch for mobile
        window.scrollTo(0, 0);
    }

    function showFAQ() {
        switchView('view-faq');
    }

    function startQuiz() {
        // Reset State
        currentIndex = 0;
        score = 0;
        // Get 5 random questions
        const shuffled = shuffleArray([...allQuestions]); // Copy before shuffle
        currentQuestions = shuffled.slice(0, 5);
        
        loadQuestion();
        switchView('view-quiz');
    }

    function loadQuestion() {
        const qData = currentQuestions[currentIndex];
        
        // Update UI
        currentQNum.innerText = currentIndex + 1;
        questionText.innerText = `Q${currentIndex + 1}. ${qData.q}`;
        explanationArea.style.display = 'none';
        explanationArea.innerHTML = '';
        
        // Reset Action Button
        btnAction.innerText = "採点する";
        btnAction.onclick = gradeQuestion;
        userSelection = null;

        // Render Options
        optionsContainer.innerHTML = '';
        qData.opts.forEach((opt, idx) => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => selectOption(idx, btn);
            optionsContainer.appendChild(btn);
        });
    }

    function selectOption(index, btnElement) {
        // Prevent selection if already graded
        if (btnAction.innerText === "次へ" || btnAction.innerText === "結果を見る") return;

        userSelection = index;
        
        // Update Styles
        const allOpts = document.querySelectorAll('.option-btn');
        allOpts.forEach(b => b.classList.remove('selected'));
        btnElement.classList.add('selected');
    }

    function gradeQuestion() {
        if (userSelection === null) {
            alert("回答を選択してください。");
            return;
        }

        const qData = currentQuestions[currentIndex];
        const allOpts = document.querySelectorAll('.option-btn');

        // Check Answer
        const isCorrect = (userSelection === qData.a);
        if (isCorrect) score++;

        // Highlight UI
        allOpts[qData.a].classList.add('correct-highlight'); // Show correct
        if (!isCorrect) {
            allOpts[userSelection].classList.add('incorrect-highlight'); // Show error
        }
        
        // Disable buttons
        allOpts.forEach(b => b.classList.add('disabled'));

        // Show Explanation
        explanationArea.innerHTML = `<strong>【解説】</strong><br>${qData.exp}`;
        explanationArea.style.display = 'block';

        // Update Button for next step
        if (currentIndex < 4) {
            btnAction.innerText = "次へ";
            btnAction.onclick = nextQuestion;
        } else {
            btnAction.innerText = "結果を見る";
            btnAction.onclick = showResults;
        }
    }

    function nextQuestion() {
        currentIndex++;
        loadQuestion();
    }

    function showResults() {
        finalScore.innerText = score + " / 5";
        
        if (score === 5) {
            resultMessage.innerText = "素晴らしい！全問正解です。\n林野火災対策の知識は完璧です。";
        } else if (score >= 3) {
            resultMessage.innerText = "合格点です。\nさらに知識を深め、現場活動に活かしてください。";
        } else {
            resultMessage.innerText = "復習が必要です。\n解説を読み返し、再度挑戦してください。";
        }

        switchView('view-result');
    }

    function retryQuiz() {
        startQuiz();
    }
</script>

</body>
</html>
```
